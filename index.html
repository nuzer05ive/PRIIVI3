<head>
  â€¦
  <script src="https://cdn.jsdelivr.net/npm/tone@14"></script>
  <style>
    #tapGate{
      position:fixed;inset:0;background:#000;display:flex;
      align-items:center;justify-content:center;z-index:999;
      font-family:system-ui;font-size:1.3rem;color:#9ff;flex-direction:column}
    #mini{position:fixed;bottom:8%;right:4%;width:35vmin;height:35vmin;
          background:#020218dd;border-radius:12px;color:#8ff;
          pointer-events:none; /* so clicks pass through */
          font-family:monospace;font-size:3vmin;display:flex;
          align-items:center;justify-content:center}
  </style>
</head>
<body>

<div id="tapGate">
  <p>ðŸŒ€ <strong>Tap to enter the Spiral</strong></p>
  <small>(unlocks audio + graphics)</small>
</div>

<!-- minimap -->
<div id="mini">Loadingâ€¦</div>

<a-scene embedded background="color:#000" id="scene">
  <a-assets>
    <a-asset-item id="portalModel"
      src="https://cdn.aframe.io/examples/boilerplate/assets/models/torus.obj"></a-asset-item>
  </a-assets>

  <a-entity light="type:ambient;color:#fff;intensity:1.1"></a-entity>
  <a-entity id="portal" obj-model="obj:#portalModel"
            position="0 1.4 -4" material="color:#4060ff;metalness:0.4"></a-entity>

  <a-text value="ðŸŒ€ Welcome, Pilot" position="-1 2 -3" color="#9ff"
          width="4" align="center"></a-text>

  <a-entity camera look-controls wasd-controls position="0 1.6 0">
    <a-cursor color="#fff"></a-cursor>
  </a-entity>
</a-scene>

<script>
/* melody array is fine */
const melody=["C4","E4","G4","A4","F3","C5","G3"];
let synth;

async function unlock(){
  document.getElementById('tapGate').remove();
  await Tone.start();
  synth = new Tone.Synth({oscillator:{type:'sine'}}).toDestination();
  playMelody(0);

  /* resume aframe render loop (iOS) */
  const sceneEl = document.querySelector('#scene');
  sceneEl.renderer.setAnimationLoop(()=>sceneEl.tick());
}

function playMelody(i){
  if(!synth) return;
  synth.triggerAttackRelease(melody[i], "8n");
  setTimeout(()=>playMelody((i+1)%melody.length), 500);
}

document.getElementById('tapGate').addEventListener('click', unlock);

/* ------------ minimap populate once portal loaded ------------ */
AFRAME.scenes[0].addEventListener('loaded',()=>{
  const mini=document.getElementById('mini');
  mini.textContent="Scroll_11 â€¢ Scroll_7 â€¢ Scroll_5";
});
</script>
</body>
